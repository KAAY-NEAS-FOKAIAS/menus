<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KAAY Admin Panel</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #111;
      color: #fff;
      padding: 2rem;
      max-width: 800px;
      margin: auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    form, .menu-section {
      margin-bottom: 2rem;
    }

    input, select, button {
      padding: 0.7rem;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      margin-bottom: 0.5rem;
      width: 100%;
    }

    input, select {
      background-color: #222;
      color: #fff;
    }

    button {
      background-color: #00b894;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #019875;
    }

    .menu-section h3 {
      border-bottom: 1px solid #444;
      padding-bottom: 0.3rem;
    }

    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.4rem 0;
      border-bottom: 1px dashed #333;
    }

    .actions button {
      margin-left: 5px;
      padding: 4px 8px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <h1>KAAY Admin Panel</h1>

  <label for="menuSelector">Choose Menu:</label>
  <select id="menuSelector">
    <option value="bar">Bar</option>
    <option value="restaurant">Restaurant</option>
    <option value="mini_market">Mini Market</option>
  </select>

  <form id="productForm">
    <input id="category" placeholder="Category" required />
    <input id="name" placeholder="Product Name" required />
    <input id="price" placeholder="Price (optional)" />
    <input id="desc" placeholder="Description (optional)" />
    <button type="submit">Add Product</button>
  </form>

  <div id="menuDisplay"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc
    } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB0HRhjtRkaTUq332zouyT2ZR-44KBd0kM",
      authDomain: "kaay-menus.firebaseapp.com",
      projectId: "kaay-menus",
      storageBucket: "kaay-menus.firebasestorage.app",
      messagingSenderId: "1064707215004",
      appId: "1:1064707215004:web:1805e202273546e1dae759"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentMenu = "bar";

    const menuSelector = document.getElementById("menuSelector");
    const categoryInput = document.getElementById("category");
    const nameInput = document.getElementById("name");
    const priceInput = document.getElementById("price");
    const descInput = document.getElementById("desc");
    const menuDisplay = document.getElementById("menuDisplay");

    menuSelector.addEventListener("change", () => {
      currentMenu = menuSelector.value;
      loadMenu();
    });

    async function loadMenu() {
      const docRef = doc(db, "menus", currentMenu);
      const docSnap = await getDoc(docRef);
      const data = docSnap.exists() ? docSnap.data() : {};
      displayMenu(data);
    }

    async function saveItem(e) {
      e.preventDefault();

      const category = categoryInput.value.trim();
      const name = nameInput.value.trim();
      const price = priceInput.value.trim();
      const desc = descInput.value.trim();

      if (!category || !name) return;

      const docRef = doc(db, "menus", currentMenu);
      const docSnap = await getDoc(docRef);
      let menuData = docSnap.exists() ? docSnap.data() : {};

      if (!menuData[category]) menuData[category] = [];
      menuData[category].push({ name, price, desc });

      await setDoc(docRef, menuData);
      loadMenu();

      nameInput.value = "";
      priceInput.value = "";
      descInput.value = "";
    }

    async function deleteItem(category, index) {
      const docRef = doc(db, "menus", currentMenu);
      const docSnap = await getDoc(docRef);
      let menuData = docSnap.data();

      menuData[category].splice(index, 1);
      if (menuData[category].length === 0) delete menuData[category];
      await setDoc(docRef, menuData);
      loadMenu();
    }

    function displayMenu(data) {
      menuDisplay.innerHTML = "";

      for (const category in data) {
        const section = document.createElement("div");
        section.className = "menu-section";
        section.innerHTML = `<h3>${category}</h3>`;

        data[category].forEach((item, index) => {
          const itemDiv = document.createElement("div");
          itemDiv.className = "item";
          itemDiv.innerHTML = `
            <div>
              <strong>${item.name}</strong><br>
              <small>${item.desc || ''}</small>
            </div>
            <div>
              ${item.price || ''}
              <span class="actions">
                <button onclick="editItem('${category}', ${index})">Edit</button>
                <button onclick="deleteItem('${category}', ${index})">Delete</button>
              </span>
            </div>
          `;
          section.appendChild(itemDiv);
        });

        menuDisplay.appendChild(section);
      }
    }

    window.deleteItem = deleteItem;

    document.getElementById("productForm").addEventListener("submit", saveItem);
    loadMenu();
  </script>
</body>
</html>