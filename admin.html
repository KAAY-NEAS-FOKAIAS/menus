<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KAAY Admin Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 1rem;
    }

    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }

    input, select, button, textarea {
      padding: 0.5rem;
      margin: 0.4rem 0;
      width: 100%;
      max-width: 500px;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
      display: block;
    }

    button {
      background-color: #28a745;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #218838;
    }

    .container {
      max-width: 600px;
      margin: auto;
    }

    .category-section {
      margin-top: 2rem;
      border-top: 1px solid #444;
      padding-top: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
    }

    th, td {
      padding: 0.6rem;
      border-bottom: 1px solid #444;
      text-align: left;
      font-size: 0.95rem;
    }

    .edit-btn, .delete-btn, .save-btn {
      background-color: #007bff;
      margin-right: 0.5rem;
      border: none;
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      cursor: pointer;
    }

    .delete-btn {
      background-color: #dc3545;
    }

    .save-btn {
      background-color: #17a2b8;
    }

    textarea {
      resize: vertical;
    }
  </style>
</head>
<body>
  <script>
    const PASSWORD = "kaay123";
    const entered = prompt("Enter admin password:");
    if (entered !== PASSWORD) {
      alert("Access denied");
      document.body.innerHTML = "<h1 style='color:white;text-align:center;margin-top:2rem;'>Access Denied ‚ùå</h1>";
      throw new Error("Unauthorized access");
    }
  </script>

  <div class="container">
    <h1>KAAY Admin Panel</h1>

    <h3>Select Menu</h3>
    <select id="menuType" onchange="switchMenu()">
      <option value="bar">Bar</option>
      <option value="restaurant">Restaurant</option>
      <option value="mini_market">Mini Market</option>
    </select>

    <h3>Add Category</h3>
    <input type="text" id="categoryInput" placeholder="Enter category name" />
    <button onclick="addCategory()">Add Category</button>

    <h3>Add Product</h3>
    <select id="categorySelect"></select>
    <input type="text" id="productName" placeholder="Product name" />
    <input type="text" id="productPrice" placeholder="Price (optional)" />
    <textarea id="productDesc" placeholder="Description (optional)"></textarea>
    <button onclick="addProduct()">Add Product</button>

    <div id="menuPreview"></div>
  </div>

  <script>
    const categoryInput = document.getElementById("categoryInput");
    const categorySelect = document.getElementById("categorySelect");
    const productName = document.getElementById("productName");
    const productPrice = document.getElementById("productPrice");
    const productDesc = document.getElementById("productDesc");
    const menuPreview = document.getElementById("menuPreview");
    const menuType = document.getElementById("menuType");

    let currentMenuKey = `kaay_menu_${menuType.value}`;
    let menu = loadMenu(currentMenuKey);

    function loadMenu(key) {
      return JSON.parse(localStorage.getItem(key)) || {};
    }

    function saveMenu() {
      localStorage.setItem(currentMenuKey, JSON.stringify(menu));
    }

    function switchMenu() {
      currentMenuKey = `kaay_menu_${menuType.value}`;
      menu = loadMenu(currentMenuKey);
      renderMenu();
    }

    function addCategory() {
      const cat = categoryInput.value.trim();
      if (cat && !menu[cat]) {
        menu[cat] = [];
        categoryInput.value = "";
        saveMenu();
        renderMenu();
      }
    }

    function addProduct() {
      const cat = categorySelect.value;
      const name = productName.value.trim();
      const price = productPrice.value.trim();
      const desc = productDesc.value.trim();
      if (cat && name) {
        menu[cat].push({ name, price, desc });
        productName.value = "";
        productPrice.value = "";
        productDesc.value = "";
        saveMenu();
        renderMenu();
      }
    }

    function editProduct(cat, index) {
  const item = menu[cat][index];
  const row = document.getElementById(`row-${cat}-${index}`);
  row.innerHTML = `
    <td><input id="edit-name-${cat}-${index}" value="${item.name}" /></td>
    <td><input id="edit-price-${cat}-${index}" value="${item.price || ''}" /></td>
    <td><textarea id="edit-desc-${cat}-${index}">${item.desc || ''}</textarea></td>
    <td>
      <button class="save-btn" onclick="saveEdit('${cat}', ${index})">Save</button>
      <button class="delete-btn" onclick="deleteProduct('${cat}', ${index})">Delete</button>
    </td>
  `;
}

    function saveEdit(cat, index) {
      const name = document.getElementById(`edit-name-${cat}-${index}`).value.trim();
      const price = document.getElementById(`edit-price-${cat}-${index}`).value.trim();
      const desc = document.getElementById(`edit-desc-${cat}-${index}`).value.trim();
      if (name) {
        menu[cat][index] = { name, price, desc };
        saveMenu();
        renderMenu();
      }
    }

    function deleteProduct(cat, index) {
      if (confirm("Are you sure you want to delete this product?")) {
        menu[cat].splice(index, 1);
        saveMenu();
        renderMenu();
      }
    }

    function renderMenu() {
      categorySelect.innerHTML = "";
      menuPreview.innerHTML = "";

      for (let category in menu) {
        const option = document.createElement("option");
        option.value = category;
        option.textContent = category;
        categorySelect.appendChild(option);

        const section = document.createElement("div");
        section.className = "category-section";
        section.innerHTML = `<h2>${category}</h2>`;

        const table = document.createElement("table");
        table.innerHTML = `
          <tr>
            <th>Name</th>
            <th>Price</th>
            <th>Description</th>
            <th>Actions</th>
          </tr>
        `;

        menu[category].forEach((item, idx) => {
          const row = document.createElement("tr");
          row.id = `row-${category}-${idx}`;
          row.innerHTML = `
            <td>${item.name}</td>
            <td>${item.price || ''}</td>
            <td>${item.desc || ''}</td>
            <td>
              <button class="edit-btn" onclick="editProduct('${category}', ${idx})">Edit</button>
              <button class="delete-btn" onclick="deleteProduct('${category}', ${idx})">Delete</button>
            </td>
          `;
          table.appendChild(row);
        });

        section.appendChild(table);
        menuPreview.appendChild(section);
      }
    }

    renderMenu();
  </script>
</body>
</html>
